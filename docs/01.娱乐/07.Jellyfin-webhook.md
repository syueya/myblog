---
title: jellyfin
date: 
permalink: /fun/jellyfin/
categories:
  - 娱乐
---



1、通过手机版钉钉->面对面建群，建立一个一人群。

2、通过PC版钉钉在群中创建一个“自定义”的Webhook机器人，名字随意，安全设置勾选“自定义关键词”，并新增两个词：播放和添加，同时把Webhook链接记录下来，链接形如https://oapi.dingtalk.com/robot/send?access_token=1234567890abcdef1234567890abcdef。

3、Jellyfin通过官方插件库安装好“Webhook”插件，并重启Jellyfin。

4、在Jellyfin的“Webhook”插件的设置界面中，点击 Add General Destination 按钮新增一个Hook，设置以下信息：

- Server Url：Jellyfin 服务器 URL
- Webhook Name：取个名，比如DingTalk
- Webhook Url：第2步中添加的“自定义”机器人的Webhook链接
- Notification Type：勾选Item Added、Playback Start、Playback Stop
- User Filter：勾选你想触发通知的用户
- Item Type：勾选你想监控的媒体类型，不能勾选其中的Send All Properties (ignores template)
- Template：填入以下内容
    ```
    {
        "msgtype": "markdown",
        "markdown": {
            {{#if_equals NotificationType 'ItemAdded'}} 
            {{#if_equals ItemType 'Season'}}
            "title": "{{{SeriesName}}} {{{Name}}} 已添加到 {{{ServerName}}}",
            {{else}}
            {{#if_equals ItemType 'Episode'}}
            "title": "{{{SeriesName}}} S{{SeasonNumber00}}E{{EpisodeNumber00}} {{{Name}}} 已添加到 {{{ServerName}}}",
            {{else}}
            "title": "{{{Name}}} ({{Year}}) 已添加到 {{{ServerName}}}",
            {{/if_equals}}
            {{/if_equals}}
            "text":
    "**媒体添加通知** \n\n
    {{#if_equals ItemType 'Season'}}
    名称：{{{SeriesName}}} S{{SeasonNumber00}} {{{Name}}}\n
    {{else}}
    {{#if_equals ItemType 'Episode'}}
    名称：{{{SeriesName}}} S{{SeasonNumber00}}E{{EpisodeNumber00}} {{{Name}}}\n
    {{else}}
    名称：{{{Name}}} ({{Year}})\n
    {{/if_equals}}
    {{/if_equals}}
    链接：
    {{~#if_exist Provider_imdb~}}
    [IMDb](https://www.imdb.com/title/{{Provider_imdb}}/)\n
    {{~/if_exist~}}
    
    {{~#if_exist Provider_tmdb~}}
    {{~#if_equals ItemType 'Movie'~}}
    [TMDb](https://www.themoviedb.org/movie/{{Provider_tmdb}})\n
    {{~else~}}
    [TMDb](https://www.themoviedb.org/tv/{{Provider_tmdb}})\n
    {{~/if_equals~}}
    {{~/if_exist~}}
    
    {{~#if_exist Provider_opendouban~}}
    [豆瓣](https://movie.douban.com/subject/{{Provider_opendouban}}/)\n
    {{~/if_exist~}}
    
    [Jellyfin]({{ServerUrl}}/web/index.html#!/details?id={{ItemId}}&serverId={{ServerId}})\n\n
    {{#if_equals ItemType 'Episode'}}
    时长：{{RunTime}}\n\n
    {{else}}
    {{#if_equals ItemType 'Movie'}}
    时长：{{RunTime}}\n\n
    {{/if_equals}}
    {{/if_equals}}
    {{~#if_exist Overview~}}
    简介：{{Overview}}
    {{~else~}}
    简介：(无)
    {{~/if_exist~}}"
            {{/if_equals}}
    
            {{#if_equals NotificationType 'PlaybackStart'}}
            "title": "{{{NotificationUsername}}} 开始播放",
            "text":
    "**开始播放通知** \n\n
    用户：{{{NotificationUsername}}}\n
    {{#if_equals ItemType 'Episode'}}
    剧集：{{{SeriesName}}} ({{Year}}) S{{SeasonNumber00}}E{{EpisodeNumber00}} - {{{Name}}}\n
    {{else}}
    电影：{{{Name}}} ({{Year}})\n
    {{/if_equals}}
    起点：{{PlaybackPosition}}\n
    设备：{{DeviceName}}\n
    终端：{{ClientName}}\n\n
    {{~#if_exist Overview~}}
    简介：{{Overview}}
    {{~/if_exist~}}"
            {{/if_equals}}
    
            {{#if_equals NotificationType 'PlaybackStop'}}    
            "title": "{{{NotificationUsername}}} 停止播放",
            "text":
    "**停止播放通知** \n\n
    用户：{{{NotificationUsername}}}\n
    {{#if_equals ItemType 'Episode'}}
    剧集：{{{SeriesName}}} ({{Year}}) S{{SeasonNumber00}}E{{EpisodeNumber00}} - {{{Name}}}\n
    {{else}}
    电影：{{{Name}}} ({{Year}})\n
    {{/if_equals}}
    设备：{{DeviceName}}\n
    终端：{{ClientName}}"
            {{/if_equals}}
        }
    }
    ```

- 点击Add Request Header，并新增一组：Key: Content-Type, Value: application/json

5、保存好配置，接下来，只要Jellyfin中有新的媒体添加进来，或者选定用户开始/停止播放媒体，你则会收到通知。


## 参数

### Helpers

- if_equals：如果第一个参数等于第二个参数,不区分大小写

- if_exist：如果参数的值不为 null 或为空

- link_to：将`$url`和`$text`包装在` <a> `标签中

### Variables:

**每个通知器**

- ServerId：服务器
- ServerName：服务器名称
- ServerVersion：服务器版本 `$major.$minor.$build`
- ServerUrl：服务器 Url
- NotificationType：通知类型
  ```
  None = 0,
  ItemAdded = 1,  // 媒体添加
  Generic = 2,  // 通用
  PlaybackStart = 3,  // 开始播放
  PlaybackProgress = 4,  // 播放进度
  PlaybackStop = 5,  // 停止播放
  SubtitleDownloadFailure = 6,  // 字幕下载失败
  AuthenticationFailure = 7,  // 身份验证失败
  AuthenticationSuccess = 8,  // 身份验证成功
  SessionStart = 9,  // 会话开始
  PendingRestart = 10,  // 挂起重启
  TaskCompleted = 11,  // 任务已完成
  PluginInstallationCancelled = 12,  // 取消安装插件
  PluginInstallationFailed = 13,  // 插件安装失败
  PluginInstalled = 14,  // 插件安装成功
  PluginInstalling = 15,  // 正在安装插件
  PluginUninstalled = 16,  // 卸载插件
  PluginUpdated = 17,  // 更新插件
  UserCreated = 18,  // 创建用户
  UserDeleted = 19,  // 删除用户
  UserLockedOut = 20,  // 锁定用户
  UserPasswordChanged = 21,  // 用户密码更改
  UserUpdated = 22,  // 用户更新
  UserDataSaved = 23  // 用户数据保存
  ```

**基础项**

- Timestamp：当前服务器时间 本地
- UtcTimestamp：当前服务器时间 UTC
- Name：媒体名称
- Overview：媒体简介
- Tagline：媒体标语
- ItemId：媒体ID
- ItemType：媒体类型
    ``` 
    Movies,  // 电影
    Episodes,  // 集
    Season,  // 季
    Series,  // 电视剧
    Albums,  // 相册
    Songs,  // 歌曲
    ```
- Year：媒体年份
- SeriesName：电视剧名称
- SeasonNumber：季数 - 直接格式
- SeasonNumber00：季数 - 填充 00
- SeasonNumber000：季数 - 填充 000
- EpisodeNumber：集数 - 直接格式
- EpisodeNumber00：集数 - 填充 00
- EpisodeNumber000：集数 - 填充 000
- Provider_{providerId_lowercase}：数据库
   ```
  Provider_imdb,  // IMDB
  Provider_tmdb,  // TMDB
  Provider_opendouban,  // 豆瓣
  ```
- RunTimeTicks：运行时间格式： [Ticks](https://docs.microsoft.com/en-us/dotnet/api/system.datetime.ticks)
- RunTime：运行时间格式： `hh:mm:ss`


**播放**

- 包括 `BaseItem`
- PlaybackPositionTicks：播放起点位置，格式为 [Ticks](https://docs.microsoft.com/en-us/dotnet/api/system.datetime.ticks)
- PlaybackPosition：播放起点位置，格式为hh:mm:ss
- MediaSourceId：媒体源 ID
- IsPaused：播放已暂停
- IsAutomated：通知是自动的，或者是用户触发的
- DeviceId：播放设备 ID
- DeviceName：播放的设备名称
- ClientName：播放的终端名称
- NotificationUsername：操作了会产生通知的用户名
- UserId：用户 ID
- PlayedToCompletion：`true/false`, 仅当 `NotificationType == PlaybackStop`

### Destination Specific

- Discord
  - MentionType 提及类型
  - EmbedColor 嵌入颜色
  - AvatarUrl
  - BotUsername 机器人用户名
- Gotify
  - Priority
- Pushbullet
- Pushover
  - Token 令 牌
  - UserToken 用户令牌
  - Device 设备
  - Title 标题
  - MessageUrl 消息 Url
  - MessageUrlTitle消息 Url标题
  - MessagePriority 消息优先级
  - NotificationSound 通知声音
- SMTP
- Slack
  - BotUsername
  - SlackIconUrl


企业微信：

```
{
"msgtype": "news",
"news": {
"articles" : [
{
{{#if_equals NotificationType 'ItemAdded'}}
{{#if_equals ItemType 'Movie'}}
"title" :"新电影：{{{Name}}}，已入库",
"description" : "电影时长:{{{RunTime}}}，点击查看详情",
"url" : "{{ServerUrl}}/web/index.html#!/details?id={{ItemId}}&serverId={{ServerId}}",
"picurl" : "{{ServerUrl}}/Items/{{ItemId}}/Images/Primary"
{{/if_equals}}
{{/if_equals}}

{{#if_equals NotificationType 'PlaybackStart'}}
{{#if_equals ItemType 'Movie'}}
"title" : "{{{DeviceName}}}开始播放电影：{{{Name}}}({{{Year}}})",
"description" : "电影时长:{{RunTime}}，电影简介：{{{Overview}}}",
"url" : "{{ServerUrl}}/web/index.html#!/details?id={{ItemId}}&serverId={{ServerId}}",
"picurl" : "{{ServerUrl}}/Items/{{ItemId}}/Images/Backdrop"
{{else}}
"title" : "{{{DeviceName}}}开始播放电视剧：{{{SeriesName}}} 第{{EpisodeNumber}}集：（{{{Name}}}）",
"description" : "本集时长:{{{RunTime}}}，当前时间：{{{Timestamp}}}",
"url" : "{{ServerUrl}}/web/index.html#!/details?id={{ItemId}}&serverId={{ServerId}}",
"picurl" : "{{ServerUrl}}/Items/{{ItemId}}/Images/Primary"
{{/if_equals}}
{{/if_equals}}

{{#if_equals NotificationType 'PlaybackStop'}}
{{#if_equals ItemType 'Movie'}}
"title" : "{{{DeviceName}}}停止播放电影：{{{Name}}}",
"description" : "当前时间：{{{Timestamp}}}",
"url" : "{{ServerUrl}}/web/index.html#!/details?id={{ItemId}}&serverId={{ServerId}}",
"picurl" : "{{ServerUrl}}/Items/{{ItemId}}/Images/Backdrop"
{{else}}
"title" : "{{{DeviceName}}}停止播放电视剧：{{{SeriesName}}}",
"description" : "当前时间：{{{Timestamp}}}",
"url" : "{{ServerUrl}}/web/index.html#!/details?id={{ItemId}}&serverId={{ServerId}}",
"picurl" : "{{ServerUrl}}/Items/{{ItemId}}/Images/Backdrop"
{{/if_equals}}
{{/if_equals}}

}
}
}

```
