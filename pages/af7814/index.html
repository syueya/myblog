<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>compose详解 | 夏夏子的博客</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/syue.ico">
    <meta name="description" content="学习笔记">
    <meta name="keywords" content="NAS技巧,电脑技巧">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.e9010ef2.css" as="style"><link rel="preload" href="/assets/js/app.f4d593bf.js" as="script"><link rel="preload" href="/assets/js/3.f41ba37f.js" as="script"><link rel="preload" href="/assets/js/38.301aa2c2.js" as="script"><link rel="prefetch" href="/assets/js/10.0dab447e.js"><link rel="prefetch" href="/assets/js/11.ad7702a4.js"><link rel="prefetch" href="/assets/js/12.36453f49.js"><link rel="prefetch" href="/assets/js/13.bb962432.js"><link rel="prefetch" href="/assets/js/14.a84242be.js"><link rel="prefetch" href="/assets/js/15.c9038d21.js"><link rel="prefetch" href="/assets/js/16.11cf57b9.js"><link rel="prefetch" href="/assets/js/17.6e85cf8b.js"><link rel="prefetch" href="/assets/js/18.439cfe89.js"><link rel="prefetch" href="/assets/js/19.03d48c4a.js"><link rel="prefetch" href="/assets/js/2.71bac117.js"><link rel="prefetch" href="/assets/js/20.a1157204.js"><link rel="prefetch" href="/assets/js/21.9738be46.js"><link rel="prefetch" href="/assets/js/22.bd058cd7.js"><link rel="prefetch" href="/assets/js/23.47d2105f.js"><link rel="prefetch" href="/assets/js/24.937ed269.js"><link rel="prefetch" href="/assets/js/25.6b46d9d2.js"><link rel="prefetch" href="/assets/js/26.7a2db952.js"><link rel="prefetch" href="/assets/js/27.b740057b.js"><link rel="prefetch" href="/assets/js/28.dc6f1024.js"><link rel="prefetch" href="/assets/js/29.d4e19af1.js"><link rel="prefetch" href="/assets/js/30.3bdce650.js"><link rel="prefetch" href="/assets/js/31.499b5d6e.js"><link rel="prefetch" href="/assets/js/32.5c467a7a.js"><link rel="prefetch" href="/assets/js/33.7f8ae5e1.js"><link rel="prefetch" href="/assets/js/34.816a8ae0.js"><link rel="prefetch" href="/assets/js/35.dfbdee51.js"><link rel="prefetch" href="/assets/js/36.5c2c8884.js"><link rel="prefetch" href="/assets/js/37.12b29948.js"><link rel="prefetch" href="/assets/js/39.765a6fe9.js"><link rel="prefetch" href="/assets/js/4.a83317df.js"><link rel="prefetch" href="/assets/js/40.77474861.js"><link rel="prefetch" href="/assets/js/41.fb1dc030.js"><link rel="prefetch" href="/assets/js/42.2b6143c6.js"><link rel="prefetch" href="/assets/js/43.39dd4caf.js"><link rel="prefetch" href="/assets/js/44.664309ae.js"><link rel="prefetch" href="/assets/js/45.d52b1c4e.js"><link rel="prefetch" href="/assets/js/46.50f19b74.js"><link rel="prefetch" href="/assets/js/47.6e8ccc4d.js"><link rel="prefetch" href="/assets/js/48.83da8092.js"><link rel="prefetch" href="/assets/js/49.981ab6d0.js"><link rel="prefetch" href="/assets/js/5.c6e4e3fc.js"><link rel="prefetch" href="/assets/js/50.7f5f8e3e.js"><link rel="prefetch" href="/assets/js/51.1ee8643a.js"><link rel="prefetch" href="/assets/js/52.bf9c21b7.js"><link rel="prefetch" href="/assets/js/53.c07d32d4.js"><link rel="prefetch" href="/assets/js/54.92f8ff12.js"><link rel="prefetch" href="/assets/js/55.ce7504d1.js"><link rel="prefetch" href="/assets/js/56.d57fa46b.js"><link rel="prefetch" href="/assets/js/57.787784be.js"><link rel="prefetch" href="/assets/js/58.7e0e7bd2.js"><link rel="prefetch" href="/assets/js/59.613e95e4.js"><link rel="prefetch" href="/assets/js/6.bbc2cd1d.js"><link rel="prefetch" href="/assets/js/7.78c6e3ba.js"><link rel="prefetch" href="/assets/js/8.5fcf84b6.js"><link rel="prefetch" href="/assets/js/9.43a4af33.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e9010ef2.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/syue.png" alt="夏夏子的博客" class="logo"> <span class="site-name can-hide">夏夏子的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NAS玩法" class="dropdown-title"><a href="/nas/" class="link-title">NAS玩法</a> <span class="title" style="display:none;">NAS玩法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/6ce0d6/" class="nav-link">影视</a></li><li class="dropdown-item"><!----> <a href="/pages/9efbd2/" class="nav-link">影视工具</a></li><li class="dropdown-item"><!----> <a href="/pages/1a4d3b/" class="nav-link">常用工具</a></li><li class="dropdown-item"><!----> <a href="/pages/ebfad1/" class="nav-link">AI工具</a></li><li class="dropdown-item"><!----> <a href="/pages/21d20f/" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><a href="/computer/" class="nav-link">电脑技巧</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/syueya/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="NAS玩法" class="dropdown-title"><a href="/nas/" class="link-title">NAS玩法</a> <span class="title" style="display:none;">NAS玩法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/6ce0d6/" class="nav-link">影视</a></li><li class="dropdown-item"><!----> <a href="/pages/9efbd2/" class="nav-link">影视工具</a></li><li class="dropdown-item"><!----> <a href="/pages/1a4d3b/" class="nav-link">常用工具</a></li><li class="dropdown-item"><!----> <a href="/pages/ebfad1/" class="nav-link">AI工具</a></li><li class="dropdown-item"><!----> <a href="/pages/21d20f/" class="nav-link">其它</a></li></ul></div></div><div class="nav-item"><a href="/computer/" class="nav-link">电脑技巧</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/syueya/myblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>影视</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>影视工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AI工具</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>其它</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/21d20f/" class="sidebar-link">其他compose</a></li><li><a href="/pages/b45934/" class="sidebar-link">TMDB API 申请</a></li><li><a href="/pages/e5ce90/" class="sidebar-link">阿里域名</a></li><li><a href="/pages/c43cbc/" class="sidebar-link">4600刷黑裙不入门</a></li><li><a href="/pages/8b767d/" class="sidebar-link">绿联安装虚拟机win11</a></li><li><a href="/pages/af7814/" aria-current="page" class="active sidebar-link">compose详解</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/af7814/#一、介绍" class="sidebar-link">一、介绍</a></li><li class="sidebar-sub-header level2"><a href="/pages/af7814/#二、compose-模板文件" class="sidebar-link">二、compose 模板文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/af7814/#顶级字段" class="sidebar-link">顶级字段</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#核心字段-services" class="sidebar-link">核心字段：services</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#编写模板文件" class="sidebar-link">编写模板文件</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#优点" class="sidebar-link">优点</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/af7814/#三、常用services配置" class="sidebar-link">三、常用services配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/af7814/#image" class="sidebar-link">image</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#container-name" class="sidebar-link">container_name</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#restart" class="sidebar-link">restart</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#network-mode" class="sidebar-link">network_mode</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#ports" class="sidebar-link">ports</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#volumes" class="sidebar-link">volumes</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#environment" class="sidebar-link">environment</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#depends-on" class="sidebar-link">depends_on</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#command" class="sidebar-link">command</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#user" class="sidebar-link">user</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#privileged" class="sidebar-link">privileged</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#resources" class="sidebar-link">resources</a></li><li class="sidebar-sub-header level3"><a href="/pages/af7814/#logging" class="sidebar-link">logging</a></li></ul></li></ul></li><li><a href="/pages/1fa68b/" class="sidebar-link">常见docker部署错误</a></li><li><a href="/pages/d79c16/" class="sidebar-link">webdav</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/nas/#NAS玩法" data-v-06225672>NAS玩法</a></li><li data-v-06225672><a href="/nas/#其它" data-v-06225672>其它</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/syueya" target="_blank" title="作者" class="beLink" data-v-06225672>夏夏子</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2025-10-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">compose详解<!----></h1>  <div class="theme-vdoing-content content__default"><h2 id="一、介绍"><a href="#一、介绍" class="header-anchor">#</a> 一、介绍</h2> <p>Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用一个单独的 docker-compose.yml 模板文件来定义一组相关联的应用容器为一个项目。</p> <p>当然，如果想使用compose的话，你得先进行安装compose，安装命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>记得赋予可执行权限：<code>sudo chmod +x /usr/local/bin/docker-compose</code></p> <p>安装完成后可以使用<code>docker compose version</code>测试是否已经安装成功。然后可以使用<code>docker compose --help</code>查看所有可用的 Docker Compose 命令。</p> <blockquote><ul><li>如果你安装的是Docker Compose V1版本，命令格式为 docker-compose（连字符形式），比如 <code>docker-compose --version</code>。</li> <li>如果安装的是 Docker Compose V2，命令格式为 docker compose（空格形式），比如 <code>docker compose version</code>。</li> <li>部分系统可能同时存在两个版本，此时需注意区分（通常新版优先级更高）。</li></ul></blockquote> <p>当然对我们来说也不用关注这些，只需要在docker应用里创建项目编写compose模板文件即可。</p> <h2 id="二、compose-模板文件"><a href="#二、compose-模板文件" class="header-anchor">#</a> 二、compose 模板文件</h2> <p>Compose 模板文件是用于定义多容器应用配置的 YAML 文件，通过声明式语法描述服务、网络、数据卷等资源，实现一键部署。具体语法细节可参考官方文档：<a href="https://docs.docker.com/reference/compose-file/" target="_blank" rel="noopener noreferrer">compose-file<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="顶级字段"><a href="#顶级字段" class="header-anchor">#</a> 顶级字段</h3> <p>模板文件的顶级字段用于全局配置应用资源，常用字段如下：</p> <ul><li>版本(version)：兼容场景需用。声明 Compose 语法版本（如 '3.8'），用于兼容不同版本的 Docker 引擎。注意：Docker Compose v2+ 已弱化该字段，不指定时默认使用最新语法，但旧版本仍需显式声明。</li> <li>名称(name)：可选。指定项目名称（默认使用当前目录名），用于区分不同 Compose 项目（如网络、卷的命名会包含项目名）。</li> <li>服务(services)：必选。定义所有服务（每个服务对应一个或多个容器），包含容器的镜像、端口、环境变量等配置。</li> <li>网络(networks)：可选。定义自定义网络，用于服务间通信隔离或跨主机网络（默认会创建一个名为 [项目名]_default 的桥接网络）。</li> <li>数据卷(volumes)：可选。定义命名卷，用于持久化数据</li> <li>配置文件(configs)：可选。定义可共享的配置文件，供多个服务挂载使用（适合非敏感配置，如应用配置文件）。</li> <li>敏感信息(secrets)：可选。定义敏感信息（如密码、证书），以安全方式挂载到服务中（避免明文暴露在配置或日志中）。</li></ul> <h3 id="核心字段-services"><a href="#核心字段-services" class="header-anchor">#</a> 核心字段：services</h3> <p>services 是模板文件的核心，每个子项代表一个服务（可理解为 “容器模板”），包含容器的所有配置（如镜像、端口、依赖等）。</p> <p>1、单服务
一个最简单的单服务配置，比如部署nginx：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  web:  # 服务名称（自定义，用于标识服务）
    image: nginx:latest  # 容器使用的镜像
    ports:  # 端口映射（主机端口:容器端口）
      - &quot;8080:80&quot;  # 主机 8080 端口映射到容器 80 端口（Nginx 默认端口）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>2、多服务
多服务配置通过在 services 下添加多个服务项实现，适合前后端、数据库等多组件架构，比如同时部署nginx和postgres：：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  web:
    image: nginx:latest
    ports:
      - &quot;8080:80&quot;

  db:
    image: postgres:13
    environment:
      POSTGRES_USER: example
      POSTGRES_DB: exampledb
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="编写模板文件"><a href="#编写模板文件" class="header-anchor">#</a> 编写模板文件</h3> <p>了解完模板文件的基础知识后，现在我们就来编写文件吧。这里以绿联为例：</p> <ol><li><p>查看需要部署的容器官方文档或者网上搜索其compose教程，比如<a href="https://hub.docker.com/r/linuxserver/qbittorrent" target="_blank" rel="noopener noreferrer">qb容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的docker hub 页面上就有参考的compose代码：
<img src="/assets/img/compose-01.761aaf5b.png" alt="img"></p></li> <li><p>打开docker应用，点击左边菜单栏的项目菜单，并在页面点击创建按钮来到创建项目页面。</p> <ul><li>填写项目名称：比如qb，部署完成后会在项目菜单下有一个名为qb的项目。</li> <li>设置路径：会在该路径下新建一个docker-compose.yaml文件，并且如果配置目录映射的主机路径时使用相对路径，也是基于该路径的。比如./downloads就是该路径下的downloads文件夹。</li> <li>把刚刚页面上的compose文件内容复制到compose配置区，如有需要则修改一些内容，一般主要修改主机端口、主机目录、一些环境变量。</li> <li>配置完成后点击立即部署即可。如果配置内容有问题，会在问题行下面打波浪线，并且下方会提示请解决配置错误，一般都是格式错误，比如缩进。
<img src="/assets/img/compose-02.7646e2e8.png" alt="img"></li></ul></li> <li><p>部署完成后可以发现项目菜单下有个qb项目了，点击该项目进去可以查看项目下的容器与日志，也可以点击Compose配置修改配置。</p></li></ol> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h3> <p>虽然我们也可以在容器菜单下点击创建按钮来部署容器，但是相对来说，我还是更喜欢通过compose来部署。</p> <ul><li>compose文件易于保存和分享，对于新手来说，抄作业就容易多了。</li> <li>对于多容器的项目来说，可以通过一个 YAML 文件定义所有服务的配置（镜像、端口、网络、依赖等），极大的简化了多容器管理。</li> <li>各项配置一目了然，如果需要修改某项配置，也只需要修改下compsoe文件即可轻松解决。</li></ul> <h2 id="三、常用services配置"><a href="#三、常用services配置" class="header-anchor">#</a> 三、常用services配置</h2> <p>服务字段也有很多配置，我们也不一一讲解，只讲解几个常用的属性，具体的可以看<a href="https://docs.docker.com/reference/compose-file/services/#attributes" target="_blank" rel="noopener noreferrer">服务属性<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="image"><a href="#image" class="header-anchor">#</a> image</h3> <p>指定容器使用的镜像与版本，如果没有指定版本，一般默认是最新版本。比如：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>image: linuxserver/qbittorrent:latest
image: linuxserver/qbittorrent:4.6.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>至于版本号，可以去docker hub官网查看对应的镜像的tags。</p> <p><img src="/assets/img/compose-03.dfdabc91.png" alt="img"></p> <h3 id="container-name"><a href="#container-name" class="header-anchor">#</a> container_name</h3> <p>指定通过compose文件部署后的容器名称，不指定则会默认生成一个名称，默认的名称格式为：项目名_服务名_序号</p> <blockquote><p>注意：指定的容器名称必须是唯一的，如果尝试创建两个相同名称的容器，Docker 将会报错。</p></blockquote> <h3 id="restart"><a href="#restart" class="header-anchor">#</a> restart</h3> <p>restart 定义了容器重启策略，一般不指定的话默认是no：</p> <ul><li>no ：退出后不会重启容器。</li> <li>always ：无论容器以何种原因退出（包括正常退出、错误退出），Docker 都会自动重启容器。</li> <li>unless-stopped ：除非手动停止容器（docker stop），否则无论容器如何退出，都会自动重启。</li> <li>on-failure[:max-retries] ：仅当容器以非 0 状态码退出（即异常退出）时，才自动重启。
<ul><li>可选参数 max-retries：限制最大重启次数（如 on-failure:3 表示最多重启 3 次，超过后停止尝试）。</li></ul></li></ul> <h3 id="network-mode"><a href="#network-mode" class="header-anchor">#</a> network_mode</h3> <p>network_mode 用于指定服务容器的网络模式，决定容器的网络栈如何与主机、其他容器关联：</p> <ul><li>bridge: 默认的网络模式。
<ul><li>未显式指定时，compose会为当前项目创建一个自定义桥接网络（默认名称为 [项目名]_default），所有服务自动加入，支持通过服务名通信，不同项目网络相互隔离（推荐）。</li> <li>显式指定了 network_mode: bridge，容器接入 Docker 原生 <code>docker0</code> 网络，仅支持 IP 通信（不推荐）。</li> <li>自定义桥接网络相比原生 docker0 的优势：支持容器间通过服务名（而非 IP）通信，且网络隔离性更好（不同项目的默认网络相互独立）。</li></ul></li> <li>host ：容器与主机共享完整网络栈（IP、端口、接口等）。
<ul><li>容器端口直接占用主机端口，无需配置 <code>ports</code>（配置会被忽略）。</li> <li>不支持跨平台（在 Windows/macOS 的 Docker Desktop 中，host 模式无法直接访问主机的 localhost，需通过特殊地址如 host.docker.internal 间接访问）。Linux 环境下可正常使用。</li> <li>端口冲突风险高，安全性较低（容器可直接访问主机网络资源）。</li></ul></li> <li>none：禁用所有网络，容器无网络接口。
<ul><li>仅适用于纯离线任务（如本地数据处理），无法与外部通信。</li></ul></li> <li>service:{name}：当前容器与同一 Compose 项目中的 {name} 服务共享网络栈。
<ul><li>共享 IP、端口，可通过 <code>localhost</code> 访问对方服务；需配合 <code>depends_on</code> 确保目标服务先启动。</li></ul></li> <li>container:{name/id}：当前容器与指定外部容器（通过名称/ID）共享网络栈。
<ul><li>依赖目标容器已存在，需手动管理其生命周期，适用于跨项目网络共享。</li></ul></li></ul> <h3 id="ports"><a href="#ports" class="header-anchor">#</a> ports</h3> <p>ports 用于定义主机和容器之间的端口映射，支持两种格式。</p> <h4 id="短格式-常用"><a href="#短格式-常用" class="header-anchor">#</a> 短格式（常用）</h4> <p>用冒号分隔的字符串来设置主机 IP、主机端口和容器端口，完整格式完整：<code>[HOST:]CONTAINER[/PROTOCOL]</code>。</p> <ul><li>HOST（可选）：表示主机端的绑定配置，格式为 [IP:](port | range)。
<ul><li>IP：主机的网络接口 IP（如 127.0.0.1 仅本地访问，192.168.1.10 绑定特定网卡），省略则默认绑定主机所有接口（0.0.0.0）。</li> <li>port | range：主机上暴露的端口（单个端口或范围，如 8080 或 9000-9002），省略则由 Docker 自动分配随机空闲端口（通常在 32768-65535 范围内）。</li></ul></li> <li>CONTAINER（必填），格式为port | range。
<ul><li>容器内服务监听的端口（单个端口或范围，如 80 或 9000-9002）。</li></ul></li> <li>PROTOCOL（可选）：指定传输协议，仅支持 tcp 或 udp，默认值为 tcp，需跟在 CONTAINER 后用 / 分隔（如 80/udp）。</li></ul> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ports:
  - &quot;8080:80&quot;               # 主机 8080 映射容器 80（tcp）
  - &quot;127.0.0.1:8081:80&quot;     # 仅本地 8081 映射容器 80
  - &quot;8082:80/udp&quot;           # 主机8082（udp）映射容器80（udp）
  - &quot;8000-8002:9000-9002&quot;   # HOST范围映射CONTAINER范围 → 8000→9000、8001→9001、8002→9002
  - &quot;9000&quot;                  # 省略HOST端口 → 主机随机端口映射容器9000
  - &quot;[::1]:8083:80&quot;         # IPv6地址（用方括号包裹）→ 仅IPv6本地回环通过8083访问容器80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>注意：</p> <ul><li>所有映射需用引号包裹（如 &quot;8080:80&quot;），避免 YAML 将冒号解析为浮点数（如 8080:80 可能被误判为 8080.80）。IPv6 地址得用方括号括起来。</li> <li>若服务配置 network_mode: host，ports 会被忽略（直接使用主机网络，无需映射）。</li> <li>主机端口需未被占用，否则容器启动失败（报错 port is already allocated）。</li> <li>一般容器端口不用变，只需要自定义前面的主机端口就行。访问是通过 <code>主机IP:主机端口</code> 访问的。</li></ul> <h4 id="长格式-更灵活"><a href="#长格式-更灵活" class="header-anchor">#</a> 长格式（更灵活）</h4> <p>支持指定协议、主机 IP 等细节，格式为字典：</p> <ul><li>name ：端口名称，用于记录其在服务中的使用情况。</li> <li>target ：容器内端口。</li> <li>published ：主机暴露的端口。</li> <li>host_ip ：主机 IP 映射。如果未设置，则绑定到所有网络接口 ( 0.0.0.0 )。</li> <li>protocol ：传输层协议（如 tcp 或 udp），默认为 tcp 。</li> <li>app_protocol ：此端口所用的应用程序协议（如 HTTP、HTTPS、MySQL、Redis 等）。</li> <li>mode ：指定 Swarm 设置中端口的发布方式，默认为 ingress。如果设置为 host ，则会在 Swarm 中的每个节点上发布该端口。如果设置为 ingress ，则会允许 Swarm 中的节点之间进行负载均衡。</li></ul> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ports:
  - name: web
    target: 80
    host_ip: 127.0.0.1
    published: &quot;8080&quot;
    protocol: tcp
    app_protocol: http
    mode: host
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="volumes"><a href="#volumes" class="header-anchor">#</a> volumes</h3> <p>volumes 属性定义服务容器可访问的挂载主机路径或命名卷，支持多种挂载类型（volume、bind、tmpfs、npipe 等）。它可以实现数据持久化、主机与容器文件共享或多容器数据共享。</p> <p>配置方式也分为短格式和长格式两种。</p> <h4 id="短格式-常用-2"><a href="#短格式-常用-2" class="header-anchor">#</a> 短格式（常用）</h4> <p>通过冒号分隔的字符串配置， <code>VOLUME:CONTAINER_PATH:ACCESS_MODE</code> 。</p> <ul><li>VOLUME ：挂载源（可选），支持两种类型
<ul><li>主机路径：主机上的目录或文件路径，可以使用绝对路径或相对路径。相对路径如<code>./data</code>是基于 Compose 文件所在目录的</li> <li>命名卷：需在顶级 volumes 中声明的预定义卷（如 my_volume），由 Docker 统一管理存储位置。</li></ul></li> <li>CONTAINER_PATH：容器路径（必填）
<ul><li>容器内需要映射的目录或文件路径，必须是绝对路径</li></ul></li> <li>ACCESS_MODE ：权限控制选项（可选）
<ul><li>rw ：读写模式（默认，容器可修改挂载内容）</li> <li>ro ：只读模式（容器仅能读取，不可修改）。</li> <li>z ：SELinux 共享标记（主机内容可被多个容器共享）。</li> <li>Z ：SELinux 私有标记（主机内容仅当前容器可用）。</li></ul></li></ul> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>volumes:
  - ./code:/app/code  # 主机当前目录 code → 容器 /app/code（默认 rw）
  - mysql_data:/var/lib/mysql  # 命名卷 mysql_data → 容器数据目录（需顶级声明）
  - /etc/hosts:/etc/hosts:ro  # 主机 hosts 文件 → 容器 hosts（只读）
  - ./config:/app/config:z  # SELinux 共享模式，允许其他容器访问
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="长格式-更灵活-2"><a href="#长格式-更灵活-2" class="header-anchor">#</a> 长格式（更灵活）</h4> <p>通过字典形式配置更多细节，常见属性：</p> <ul><li>type（必填） ：挂载类型。支持 volume、bind、tmpfs、image、npipe、cluster</li> <li>source（必填） ：源路径。主机路径或命名卷（与 type 对应）</li> <li>target（必填） ：容器路径。</li> <li>read_only ：是否只读（可选，默认 false）。</li></ul> <p>以下为类型专属配置（按需添加）</p> <ul><li>bind ：仅 type: bind 时生效：
<ul><li>propagation ：传播模式。如 rprivate、shared（控制挂载权限传播）</li> <li>create_host_path ：主机路径不存在时是否自动创建。默认为 true 。</li> <li>selinux ：SELinux 标记， z （共享）或 Z （私有）</li></ul></li> <li>volume ：仅 type: volume 时生效
<ul><li>nocopy ：创建卷时是否跳过从容器复制数据（默认 false）</li> <li>subpath ：挂载卷内的子目录（如卷 my_volume 的 /logs 子目录）</li></ul></li> <li>tmpfs ：仅 type: tmpfs 时生效
<ul><li>size ：临时卷大小，如 100m、512k。</li> <li>mode ：文件权限。以八进制数表示 Unix 权限位，如 0755。</li></ul></li> <li>image ：仅 type: image 时生效（从其他镜像挂载数据）
<ul><li>subpath ：源镜像内的子路径</li></ul></li> <li>consistency ：挂载的一致性要求。可用值因平台而异（如 macOS 的 delegated、cached）。</li></ul> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>volumes:
  - type: bind
    source: ./data
    target: /app/data
    read_only: true
    bind:
      create_host_path: false  # 主机路径不存在时不自动创建（避免误创建）

- type: volume
  source: logs_volume
  target: /app/logs
  volume:
    subpath: app_logs  # 仅挂载 logs_volume 卷内的 app_logs 子目录

- type: tmpfs
  target: /app/cache
  tmpfs:
    size: 50m  # 限制临时卷大小为 50MB
    mode: 0777  # 允许所有用户读写
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="注意事项"><a href="#注意事项" class="header-anchor">#</a> 注意事项</h4> <ol><li>路径格式：</li></ol> <ul><li>主机路径在 Windows 上需用反斜杠（C:\data:/app/data），Linux/macOS 用正斜杠（/data:/app/data）。</li> <li>容器路径必须是绝对路径（如 /app/data，不能是 app/data）。</li></ul> <ol start="2"><li>权限问题：绑定挂载时，主机文件/目录的权限直接影响容器访问，需提前用chmod 或 chown在主机设置目录权限。</li> <li>数据覆盖：挂载后，容器路径原有的文件/目录会被挂载源内容覆盖（卸载后恢复容器原内容）。</li> <li>顶级 volumes 关联：</li></ol> <ul><li>命名卷必须在顶级 volumes 中声明。</li> <li>绑定挂载（bind）、临时卷（tmpfs）无需在顶级声明</li></ul> <h3 id="environment"><a href="#environment" class="header-anchor">#</a> environment</h3> <p>environment 属性定义了容器中设置的环境变量。支持两种配置格式：Array（数组）和Map（映射），可根据需求选择。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># Array（数组）格式
environment:
  - SHOW=true


# Map（映射）格式
environment:
  SHOW: &quot;true&quot;

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意事项：</p> <ol><li>值的来源</li></ol> <ul><li>显式定义：直接在environment里指定的变量值，优先级最高。</li> <li>继承主机变量：容器会继承主机中同名环境变量的值（若主机未定义，则容器内该变量为空）</li> <li>引用其他变量：容器内的环境变量可引用已定义的变量（如 PATH=$HOME/bin:$PATH），但需注意 Compose 不会解析变量，仅原样传递给容器，由容器内的 shell 解析。</li> <li>优先级：environment 中显式定义的变量会覆盖 env_file 或 .env 文件中同名的变量（显式定义 &gt; env_file &gt; .env）。</li></ul> <ol start="2"><li>特殊字符处理</li></ol> <ul><li>若值包含空格、引号、冒号等特殊字符，建议用Map（映射）格式并加引号（如 KEY: &quot;Hello: World&quot;），避免 YAML 解析错误。</li> <li>单引号和双引号的区别：双引号内的特殊字符（如 $）会被容器内的 shell 解析，单引号则原样保留（如 KEY: '$(echo hello)' 会保留字符串 $(echo hello)，而 KEY: &quot;$(echo hello)&quot; 会被解析为 hello）。</li></ul> <ol start="3"><li>可在 Compose 文件所在目录创建 .env 文件存储环境变量，然后在 environment 中通过 ${变量名} 引用，实现配置与代码分离。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code># .env 文件内容：
DB_PASSWORD=secret123
APP_ENV=production

# Compose 配置

services:
  app:
    environment:
      - DB_PASS=${DB_PASSWORD}  # 引用 .env 中的 DB_PASSWORD
      - ENV=${APP_ENV:-development}  # 若 APP_ENV 未定义，默认值为 development
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ol start="4"><li>与 env_file 的区别</li></ol> <ul><li>environment 用于直接在 Compose 文件中定义环境变量，适合少量关键配置。</li> <li>env_file 属性用于指定一个或多个包含要传递给容器的环境变量的文件，适合大量配置：<div class="language- line-numbers-mode"><pre class="language-text"><code># 列表中的文件按从上到下的顺序处理
env_file:
  - ./a.env
  - ./b.env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <ol start="5"><li><p>敏感信息安全：environment 中的变量会明文显示在 docker compose config、docker inspect 等命令的输出中，不适合存储密码、密钥等敏感信息（建议使用 Docker Secrets 或外部密钥管理工具）。</p></li> <li><p>容器内可见性：环境变量仅在容器启动时注入，若容器内的应用程序需要动态刷新配置，需通过其他方式（如配置文件挂载）实现。</p></li></ol> <h3 id="depends-on"><a href="#depends-on" class="header-anchor">#</a> depends_on</h3> <p>depends_on 属性用于定义服务之间的依赖关系，控制服务的启动、关闭顺序及依赖条件（如等待依赖服务就绪），确保服务按预期依赖关系运行。</p> <h4 id="短语法"><a href="#短语法" class="header-anchor">#</a> 短语法</h4> <p>通过列表指定依赖的服务名称，仅控制启动和关闭的先后顺序，不包含额外条件。行为说明：</p> <ul><li>启动顺序：依赖的服务会先于当前服务创建（如 web 依赖 db 和 redis，则 db、redis 先启动，再启动 web）。</li> <li>关闭顺序：当前服务会先于依赖的服务删除（如 web 先停止，再停止 db、redis）。</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  web:
    depends_on:
      - db    # web 依赖 db，db 先启动
      - redis # web 依赖 redis，redis 先启动
  db:
    image: mysql
  redis:
    image: redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="长语法"><a href="#长语法" class="header-anchor">#</a> 长语法</h4> <p>通过字典形式配置依赖的详细条件，支持更精细的依赖控制，包含以下字段：</p> <ul><li>condition（必填） ：设置依赖关系被视为满足的条件
<ul><li>service_started ：依赖服务启动即可（与短语法等效），不保证服务内部已就绪（如数据库启动但未完成初始化）</li> <li>service_healthy ：依赖服务必须通过 healthcheck 检查（标记为 “健康”）</li> <li>service_completed_successfully ：依赖服务必须成功运行并退出（如一次性任务）</li></ul></li> <li>restart（可选） ：设为 true 时，若依赖服务更新（如重启、重建），当前服务会自动重启（仅针对 Compose 显式操作，不包括容器运行时的自动重启）</li> <li>required（可选） ：设为 false 时，若依赖服务未启动或不可用，Compose 仅警告不终止操作。默认 true，即依赖服务必须可用，否则当前服务启动失败</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  web:
    depends_on:
      db:
        condition: service_healthy  # 等待 db 健康检查通过才启动 web
        restart: true               # 若 db 重启，web 也自动重启
      redis:
        condition: service_started  # 仅需 redis 启动即可
        required: false             # 即使 redis 不可用，也仅警告不终止 web 启动
  db:
    image: mysql
    healthcheck:  # 定义健康检查（配合 service_healthy 使用）
      test: [&quot;CMD&quot;, &quot;mysqladmin&quot;, &quot;ping&quot;, &quot;-h&quot;, &quot;localhost&quot;]
      interval: 10s
      timeout: 5s
      retries: 5
  redis:
    image: redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="command"><a href="#command" class="header-anchor">#</a> command</h3> <p>command 覆盖容器镜像声明的默认命令，例如 Dockerfile 的 CMD。command 支持两种配置方式，根据命令的复杂度选择。</p> <h4 id="字符串格式"><a href="#字符串格式" class="header-anchor">#</a> 字符串格式</h4> <p>直接以字符串形式指定命令，与在终端执行命令的格式一致：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>command: python script.py  # 启动时执行 python script.py（覆盖镜像默认命令）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="列表格式"><a href="#列表格式" class="header-anchor">#</a> 列表格式</h4> <p>适合含空格或特殊字符的命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>command: [&quot;python&quot;, &quot;script.py&quot;, &quot;--debug&quot;, &quot;true&quot;]  # 等效于 python script.py --debug true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="规则"><a href="#规则" class="header-anchor">#</a> 规则</h4> <ol><li>与镜像默认命令的关系</li></ol> <ul><li>镜像的 Dockerfile 中通常会用 CMD 定义默认命令（如 CMD [&quot;nginx&quot;, &quot;-g&quot;, &quot;daemon off;&quot;]）。</li> <li>command 会完全覆盖 CMD 的值，但不会覆盖 ENTRYPOINT（若镜像定义了 ENTRYPOINT，command 的值会作为参数传递给 ENTRYPOINT）。</li> <li>command 的优先级高于镜像的 CMD，但低于 entrypoint。</li></ul> <ol start="2"><li>命令执行环境</li></ol> <ul><li>命令在容器的默认工作目录（由镜像 WORKDIR 定义）中执行，若需指定其他目录，可在命令中包含路径（如 cd /app &amp;&amp; python script.py）。</li> <li>命令可引用容器内的环境变量（如 command: echo &quot;DB_HOST is $DB_HOST&quot;，需确保变量已通过 environment 定义）。</li></ul> <ol start="3"><li>特殊场景处理</li></ol> <ul><li>若命令包含管道（|）、重定向（&gt;）等 shell 特性，需显式通过 shell 执行，否则可能失效：<div class="language- line-numbers-mode"><pre class="language-text"><code># 正确：通过 /bin/sh 执行带管道的命令
command: /bin/sh -c &quot;ls /app | grep .py&quot;

# 错误：直接使用管道，可能无法解析
command: ls /app | grep .py
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>多行命令可通过列表或 shell 分号拼接：<code>command: /bin/sh -c &quot;python setup.py; python run.py&quot;</code></li></ul> <h3 id="user"><a href="#user" class="header-anchor">#</a> user</h3> <p>user用于指定运行容器进程的用户 / 用户组，默认继承镜像的USER配置（Dockerfile 中定义），未定义则为root（UID=0）。</p> <p>它有三种写法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 写法1：直接写用户名 / 用户ID（新手推荐，简洁通用）
user: root  # 用户名（root是Linux系统默认超级用户，等价UID=0）
user: 0     # UID（root的UID固定为0）

# 写法2：用户名:用户组 / UID:GID（精准控制权限）
user: 1000:1000  # UID:GID（普通用户常用ID，推荐）
user: admin:admin  # 用户名:用户组（⚠️ 容器内必须预先存在该用户/组，否则启动失败）

# 写法3：仅指定用户组（极少用，特殊权限隔离）
user: :1000  # 仅指定GID，用户名沿用容器默认（通常是root）

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="privileged"><a href="#privileged" class="header-anchor">#</a> privileged</h3> <p>默认情况下，容器受 Linux 命名空间隔离，权限受限；开启特权模式后，容器可突破隔离，授予容器几乎与主机相同的权限（如访问所有设备、修改内核参数等）。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>privileged: true  # 开启特权模式（默认 false）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>注意：特权模式会显著降低容器安全性，仅在必要场景（如需要直接访问主机硬件、修改内核配置）使用，生产环境需谨慎。</p></blockquote> <h3 id="resources"><a href="#resources" class="header-anchor">#</a> resources</h3> <p>resources 用于配置容器的资源约束（CPU、内存等），控制容器对主机物理资源的使用，避免单个容器过度占用资源。</p> <p>deploy.resources 主要用于 Swarm 集群，单机模式下部分配置（如 cpus、memory）可直接生效，但推荐统一用 deploy 字段保持兼容性。其中develop 是开发环境专属配置，用于实现代码自动同步、服务热更新，减少手动重启 / 重建操作，提升开发效率。</p> <p>核心配置项：</p> <ul><li>limits ：容器可使用的最大资源（平台强制限制，超出会被节流或终止）。</li> <li>reservations ：容器需保证分配的最小资源（平台优先满足，未达此值可能启动失败）。</li></ul> <p>常用资源类型：</p> <ul><li>cpus: CPU 核心数限制 / 预留（如 '1' 表示 1 核，'0.5' 表示半核）。</li> <li>memory：内存限制 / 预留（支持单位 M/G，如 2G、1024M）。</li> <li>pids：容器内允许的最大进程数（整数，如 100 限制最多 100 个进程）。</li> <li>devices：硬件设备预留（如 GPU、TPU），需配合以下子字段：
<ul><li>capabilities（必填）：设备功能列表（如 [gpu] 表示需要 GPU）。</li> <li>driver（可选）：设备驱动程序（如 nvidia 针对 NVIDIA GPU）。</li> <li>count（可选）：预留设备数量（all 表示所有符合条件的设备，整数表示至少 N 个）。</li> <li>device_ids（可选）：指定设备 ID 列表（与 count 互斥）。</li></ul></li></ul> <p>示例：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>services:
  app:
    image: myapp
    deploy:  # Swarm 模式下用 deploy.resources
      resources:
        limits:
          cpus: '2'        # 最多使用 2 核 CPU
          memory: 4G       # 最多使用 4GB 内存
          pids: 500        # 最多 500 个进程
        reservations:
          cpus: '1'        # 至少保证 1 核 CPU
          memory: 2G       # 至少保证 2GB 内存
          devices:
            - capabilities: [gpu]  # 预留 GPU 设备
              driver: nvidia       # 使用 NVIDIA 驱动
              count: 1             # 至少 1 个 GPU

  # 单机模式（非 Swarm）可直接在服务下配置 resources（部分版本支持）
  worker:
    image: worker
    resources:
      limits:
        cpus: '0.5'
        memory: 1G

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="logging"><a href="#logging" class="header-anchor">#</a> logging</h3> <p>logging 用于配置容器的日志记录，默认使用 Docker 的内置日志系统，可自定义日志记录方式、存储位置等。</p> <p>参数详解</p> <ul><li>driver：指定日志驱动类型
<ul><li>json-file（默认）：日志存为 JSON 文件</li> <li>local：本地日志驱动</li> <li>syslog：发送到 syslog 服务器</li> <li>journald：发送到 systemd journal</li> <li>none：禁用日志收集</li></ul></li> <li>options：驱动的自定义配置，不同驱动的 options 不同</li></ul> <p>常用 logging 配置示例</p> <div class="language- line-numbers-mode"><pre class="language-text"><code># 本地日志轮转（最常用）
# 针对默认的 json-file 或 local 驱动，配置日志大小限制和轮转，避免日志文件占满磁盘
logging:
  driver: &quot;local&quot;
  options:
    max-size: &quot;10m&quot;    # 单个日志文件最大 10MB
    max-file: &quot;3&quot;      # 最多保留 3 个日志文件
    compress: &quot;true&quot;   # 轮转后的日志自动压缩（仅 local 驱动支持）
    

# 禁用容器日志
# 适用于不需要日志的临时容器
logging:
  driver: &quot;none&quot;  # 完全禁用日志收集

# 输出到 syslog 服务器
# 适用于集中化日志收集（需提前部署 syslog 服务器）
logging:
  driver: &quot;syslog&quot;
  options:
    syslog-address: &quot;tcp://192.168.1.100:514&quot;  # syslog 服务器地址
    syslog-tag: &quot;my-api&quot;                       # 日志标签（便于区分服务）
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div></div>  <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2026/02/06, 15:30:48</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/8b767d/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">绿联安装虚拟机win11</div></a> <a href="/pages/1fa68b/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">常见docker部署错误</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/8b767d/" class="prev">绿联安装虚拟机win11</a></span> <span class="next"><a href="/pages/1fa68b/">常见docker部署错误</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/f36fae/"><div>
            octopus
            <!----></div></a> <span class="date">02-04</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/d79c16/"><div>
            webdav
            <!----></div></a> <span class="date">01-29</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/d4036b/"><div>
            free-api系列
            <!----></div></a> <span class="date">01-29</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2025-2026
    <span>夏夏子 | <a href="https://github.com/syueya/myblog/blob/main/LICENSE" target="_blank">MIT License</a> </span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.f4d593bf.js" defer></script><script src="/assets/js/3.f41ba37f.js" defer></script><script src="/assets/js/38.301aa2c2.js" defer></script>
  </body>
</html>
