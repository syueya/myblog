(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{1078:function(s,e,a){"use strict";a.r(e);var n=a(11),t=Object(n.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"一、介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、介绍"}},[s._v("#")]),s._v(" 一、介绍")]),s._v(" "),e("p",[s._v("Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用一个单独的 docker-compose.yml 模板文件来定义一组相关联的应用容器为一个项目。")]),s._v(" "),e("p",[s._v("当然，如果想使用compose的话，你得先进行安装compose，安装命令：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("记得赋予可执行权限："),e("code",[s._v("sudo chmod +x /usr/local/bin/docker-compose")])]),s._v(" "),e("p",[s._v("安装完成后可以使用"),e("code",[s._v("docker compose version")]),s._v("测试是否已经安装成功。然后可以使用"),e("code",[s._v("docker compose --help")]),s._v("查看所有可用的 Docker Compose 命令。")]),s._v(" "),e("blockquote",[e("ul",[e("li",[s._v("如果你安装的是Docker Compose V1版本，命令格式为 docker-compose（连字符形式），比如 "),e("code",[s._v("docker-compose --version")]),s._v("。")]),s._v(" "),e("li",[s._v("如果安装的是 Docker Compose V2，命令格式为 docker compose（空格形式），比如 "),e("code",[s._v("docker compose version")]),s._v("。")]),s._v(" "),e("li",[s._v("部分系统可能同时存在两个版本，此时需注意区分（通常新版优先级更高）。")])])]),s._v(" "),e("p",[s._v("当然对我们来说也不用关注这些，只需要在docker应用里创建项目编写compose模板文件即可。")]),s._v(" "),e("h2",{attrs:{id:"二、compose-模板文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、compose-模板文件"}},[s._v("#")]),s._v(" 二、compose 模板文件")]),s._v(" "),e("p",[s._v("Compose 模板文件是用于定义多容器应用配置的 YAML 文件，通过声明式语法描述服务、网络、数据卷等资源，实现一键部署。具体语法细节可参考官方文档："),e("a",{attrs:{href:"https://docs.docker.com/reference/compose-file/",target:"_blank",rel:"noopener noreferrer"}},[s._v("compose-file"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"顶级字段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#顶级字段"}},[s._v("#")]),s._v(" 顶级字段")]),s._v(" "),e("p",[s._v("模板文件的顶级字段用于全局配置应用资源，常用字段如下：")]),s._v(" "),e("ul",[e("li",[s._v("版本(version)：兼容场景需用。声明 Compose 语法版本（如 '3.8'），用于兼容不同版本的 Docker 引擎。注意：Docker Compose v2+ 已弱化该字段，不指定时默认使用最新语法，但旧版本仍需显式声明。")]),s._v(" "),e("li",[s._v("名称(name)：可选。指定项目名称（默认使用当前目录名），用于区分不同 Compose 项目（如网络、卷的命名会包含项目名）。")]),s._v(" "),e("li",[s._v("服务(services)：必选。定义所有服务（每个服务对应一个或多个容器），包含容器的镜像、端口、环境变量等配置。")]),s._v(" "),e("li",[s._v("网络(networks)：可选。定义自定义网络，用于服务间通信隔离或跨主机网络（默认会创建一个名为 [项目名]_default 的桥接网络）。")]),s._v(" "),e("li",[s._v("数据卷(volumes)：可选。定义命名卷，用于持久化数据")]),s._v(" "),e("li",[s._v("配置文件(configs)：可选。定义可共享的配置文件，供多个服务挂载使用（适合非敏感配置，如应用配置文件）。")]),s._v(" "),e("li",[s._v("敏感信息(secrets)：可选。定义敏感信息（如密码、证书），以安全方式挂载到服务中（避免明文暴露在配置或日志中）。")])]),s._v(" "),e("h3",{attrs:{id:"核心字段-services"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#核心字段-services"}},[s._v("#")]),s._v(" 核心字段：services")]),s._v(" "),e("p",[s._v("services 是模板文件的核心，每个子项代表一个服务（可理解为 “容器模板”），包含容器的所有配置（如镜像、端口、依赖等）。")]),s._v(" "),e("p",[s._v("1、单服务\n一个最简单的单服务配置，比如部署nginx：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('services:\n  web:  # 服务名称（自定义，用于标识服务）\n    image: nginx:latest  # 容器使用的镜像\n    ports:  # 端口映射（主机端口:容器端口）\n      - "8080:80"  # 主机 8080 端口映射到容器 80 端口（Nginx 默认端口）\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("2、多服务\n多服务配置通过在 services 下添加多个服务项实现，适合前后端、数据库等多组件架构，比如同时部署nginx和postgres：：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('services:\n  web:\n    image: nginx:latest\n    ports:\n      - "8080:80"\n\n  db:\n    image: postgres:13\n    environment:\n      POSTGRES_USER: example\n      POSTGRES_DB: exampledb\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"编写模板文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#编写模板文件"}},[s._v("#")]),s._v(" 编写模板文件")]),s._v(" "),e("p",[s._v("了解完模板文件的基础知识后，现在我们就来编写文件吧。这里以绿联为例：")]),s._v(" "),e("ol",[e("li",[e("p",[s._v("查看需要部署的容器官方文档或者网上搜索其compose教程，比如"),e("a",{attrs:{href:"https://hub.docker.com/r/linuxserver/qbittorrent",target:"_blank",rel:"noopener noreferrer"}},[s._v("qb容器"),e("OutboundLink")],1),s._v("的docker hub 页面上就有参考的compose代码：\n"),e("img",{attrs:{src:a(991),alt:"img"}})])]),s._v(" "),e("li",[e("p",[s._v("打开docker应用，点击左边菜单栏的项目菜单，并在页面点击创建按钮来到创建项目页面。")]),s._v(" "),e("ul",[e("li",[s._v("填写项目名称：比如qb，部署完成后会在项目菜单下有一个名为qb的项目。")]),s._v(" "),e("li",[s._v("设置路径：会在该路径下新建一个docker-compose.yaml文件，并且如果配置目录映射的主机路径时使用相对路径，也是基于该路径的。比如./downloads就是该路径下的downloads文件夹。")]),s._v(" "),e("li",[s._v("把刚刚页面上的compose文件内容复制到compose配置区，如有需要则修改一些内容，一般主要修改主机端口、主机目录、一些环境变量。")]),s._v(" "),e("li",[s._v("配置完成后点击立即部署即可。如果配置内容有问题，会在问题行下面打波浪线，并且下方会提示请解决配置错误，一般都是格式错误，比如缩进。\n"),e("img",{attrs:{src:a(992),alt:"img"}})])])]),s._v(" "),e("li",[e("p",[s._v("部署完成后可以发现项目菜单下有个qb项目了，点击该项目进去可以查看项目下的容器与日志，也可以点击Compose配置修改配置。")])])]),s._v(" "),e("h3",{attrs:{id:"优点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[s._v("#")]),s._v(" 优点")]),s._v(" "),e("p",[s._v("虽然我们也可以在容器菜单下点击创建按钮来部署容器，但是相对来说，我还是更喜欢通过compose来部署。")]),s._v(" "),e("ul",[e("li",[s._v("compose文件易于保存和分享，对于新手来说，抄作业就容易多了。")]),s._v(" "),e("li",[s._v("对于多容器的项目来说，可以通过一个 YAML 文件定义所有服务的配置（镜像、端口、网络、依赖等），极大的简化了多容器管理。")]),s._v(" "),e("li",[s._v("各项配置一目了然，如果需要修改某项配置，也只需要修改下compsoe文件即可轻松解决。")])]),s._v(" "),e("h2",{attrs:{id:"三、常用services配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、常用services配置"}},[s._v("#")]),s._v(" 三、常用services配置")]),s._v(" "),e("p",[s._v("服务字段也有很多配置，我们也不一一讲解，只讲解几个常用的属性，具体的可以看"),e("a",{attrs:{href:"https://docs.docker.com/reference/compose-file/services/#attributes",target:"_blank",rel:"noopener noreferrer"}},[s._v("服务属性"),e("OutboundLink")],1),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"image"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#image"}},[s._v("#")]),s._v(" image")]),s._v(" "),e("p",[s._v("指定容器使用的镜像与版本，如果没有指定版本，一般默认是最新版本。比如：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("image: linuxserver/qbittorrent:latest\nimage: linuxserver/qbittorrent:4.6.7\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("至于版本号，可以去docker hub官网查看对应的镜像的tags。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(993),alt:"img"}})]),s._v(" "),e("h3",{attrs:{id:"container-name"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#container-name"}},[s._v("#")]),s._v(" container_name")]),s._v(" "),e("p",[s._v("指定通过compose文件部署后的容器名称，不指定则会默认生成一个名称，默认的名称格式为：项目名_服务名_序号")]),s._v(" "),e("blockquote",[e("p",[s._v("注意：指定的容器名称必须是唯一的，如果尝试创建两个相同名称的容器，Docker 将会报错。")])]),s._v(" "),e("h3",{attrs:{id:"restart"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#restart"}},[s._v("#")]),s._v(" restart")]),s._v(" "),e("p",[s._v("restart 定义了容器重启策略，一般不指定的话默认是no：")]),s._v(" "),e("ul",[e("li",[s._v("no ：退出后不会重启容器。")]),s._v(" "),e("li",[s._v("always ：无论容器以何种原因退出（包括正常退出、错误退出），Docker 都会自动重启容器。")]),s._v(" "),e("li",[s._v("unless-stopped ：除非手动停止容器（docker stop），否则无论容器如何退出，都会自动重启。")]),s._v(" "),e("li",[s._v("on-failure[:max-retries] ：仅当容器以非 0 状态码退出（即异常退出）时，才自动重启。\n"),e("ul",[e("li",[s._v("可选参数 max-retries：限制最大重启次数（如 on-failure:3 表示最多重启 3 次，超过后停止尝试）。")])])])]),s._v(" "),e("h3",{attrs:{id:"network-mode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#network-mode"}},[s._v("#")]),s._v(" network_mode")]),s._v(" "),e("p",[s._v("network_mode 用于指定服务容器的网络模式，决定容器的网络栈如何与主机、其他容器关联：")]),s._v(" "),e("ul",[e("li",[s._v("bridge: 默认的网络模式。\n"),e("ul",[e("li",[s._v("未显式指定时，compose会为当前项目创建一个自定义桥接网络（默认名称为 [项目名]_default），所有服务自动加入，支持通过服务名通信，不同项目网络相互隔离（推荐）。")]),s._v(" "),e("li",[s._v("显式指定了 network_mode: bridge，容器接入 Docker 原生 "),e("code",[s._v("docker0")]),s._v(" 网络，仅支持 IP 通信（不推荐）。")]),s._v(" "),e("li",[s._v("自定义桥接网络相比原生 docker0 的优势：支持容器间通过服务名（而非 IP）通信，且网络隔离性更好（不同项目的默认网络相互独立）。")])])]),s._v(" "),e("li",[s._v("host ：容器与主机共享完整网络栈（IP、端口、接口等）。\n"),e("ul",[e("li",[s._v("容器端口直接占用主机端口，无需配置 "),e("code",[s._v("ports")]),s._v("（配置会被忽略）。")]),s._v(" "),e("li",[s._v("不支持跨平台（在 Windows/macOS 的 Docker Desktop 中，host 模式无法直接访问主机的 localhost，需通过特殊地址如 host.docker.internal 间接访问）。Linux 环境下可正常使用。")]),s._v(" "),e("li",[s._v("端口冲突风险高，安全性较低（容器可直接访问主机网络资源）。")])])]),s._v(" "),e("li",[s._v("none：禁用所有网络，容器无网络接口。\n"),e("ul",[e("li",[s._v("仅适用于纯离线任务（如本地数据处理），无法与外部通信。")])])]),s._v(" "),e("li",[s._v("service:{name}：当前容器与同一 Compose 项目中的 {name} 服务共享网络栈。\n"),e("ul",[e("li",[s._v("共享 IP、端口，可通过 "),e("code",[s._v("localhost")]),s._v(" 访问对方服务；需配合 "),e("code",[s._v("depends_on")]),s._v(" 确保目标服务先启动。")])])]),s._v(" "),e("li",[s._v("container:{name/id}：当前容器与指定外部容器（通过名称/ID）共享网络栈。\n"),e("ul",[e("li",[s._v("依赖目标容器已存在，需手动管理其生命周期，适用于跨项目网络共享。")])])])]),s._v(" "),e("h3",{attrs:{id:"ports"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ports"}},[s._v("#")]),s._v(" ports")]),s._v(" "),e("p",[s._v("ports 用于定义主机和容器之间的端口映射，支持两种格式。")]),s._v(" "),e("h4",{attrs:{id:"短格式-常用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#短格式-常用"}},[s._v("#")]),s._v(" 短格式（常用）")]),s._v(" "),e("p",[s._v("用冒号分隔的字符串来设置主机 IP、主机端口和容器端口，完整格式完整："),e("code",[s._v("[HOST:]CONTAINER[/PROTOCOL]")]),s._v("。")]),s._v(" "),e("ul",[e("li",[s._v("HOST（可选）：表示主机端的绑定配置，格式为 [IP:](port | range)。\n"),e("ul",[e("li",[s._v("IP：主机的网络接口 IP（如 127.0.0.1 仅本地访问，192.168.1.10 绑定特定网卡），省略则默认绑定主机所有接口（0.0.0.0）。")]),s._v(" "),e("li",[s._v("port | range：主机上暴露的端口（单个端口或范围，如 8080 或 9000-9002），省略则由 Docker 自动分配随机空闲端口（通常在 32768-65535 范围内）。")])])]),s._v(" "),e("li",[s._v("CONTAINER（必填），格式为port | range。\n"),e("ul",[e("li",[s._v("容器内服务监听的端口（单个端口或范围，如 80 或 9000-9002）。")])])]),s._v(" "),e("li",[s._v("PROTOCOL（可选）：指定传输协议，仅支持 tcp 或 udp，默认值为 tcp，需跟在 CONTAINER 后用 / 分隔（如 80/udp）。")])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ports:\n  - "8080:80"               # 主机 8080 映射容器 80（tcp）\n  - "127.0.0.1:8081:80"     # 仅本地 8081 映射容器 80\n  - "8082:80/udp"           # 主机8082（udp）映射容器80（udp）\n  - "8000-8002:9000-9002"   # HOST范围映射CONTAINER范围 → 8000→9000、8001→9001、8002→9002\n  - "9000"                  # 省略HOST端口 → 主机随机端口映射容器9000\n  - "[::1]:8083:80"         # IPv6地址（用方括号包裹）→ 仅IPv6本地回环通过8083访问容器80\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("注意：")]),s._v(" "),e("ul",[e("li",[s._v('所有映射需用引号包裹（如 "8080:80"），避免 YAML 将冒号解析为浮点数（如 8080:80 可能被误判为 8080.80）。IPv6 地址得用方括号括起来。')]),s._v(" "),e("li",[s._v("若服务配置 network_mode: host，ports 会被忽略（直接使用主机网络，无需映射）。")]),s._v(" "),e("li",[s._v("主机端口需未被占用，否则容器启动失败（报错 port is already allocated）。")]),s._v(" "),e("li",[s._v("一般容器端口不用变，只需要自定义前面的主机端口就行。访问是通过 "),e("code",[s._v("主机IP:主机端口")]),s._v(" 访问的。")])]),s._v(" "),e("h4",{attrs:{id:"长格式-更灵活"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#长格式-更灵活"}},[s._v("#")]),s._v(" 长格式（更灵活）")]),s._v(" "),e("p",[s._v("支持指定协议、主机 IP 等细节，格式为字典：")]),s._v(" "),e("ul",[e("li",[s._v("name ：端口名称，用于记录其在服务中的使用情况。")]),s._v(" "),e("li",[s._v("target ：容器内端口。")]),s._v(" "),e("li",[s._v("published ：主机暴露的端口。")]),s._v(" "),e("li",[s._v("host_ip ：主机 IP 映射。如果未设置，则绑定到所有网络接口 ( 0.0.0.0 )。")]),s._v(" "),e("li",[s._v("protocol ：传输层协议（如 tcp 或 udp），默认为 tcp 。")]),s._v(" "),e("li",[s._v("app_protocol ：此端口所用的应用程序协议（如 HTTP、HTTPS、MySQL、Redis 等）。")]),s._v(" "),e("li",[s._v("mode ：指定 Swarm 设置中端口的发布方式，默认为 ingress。如果设置为 host ，则会在 Swarm 中的每个节点上发布该端口。如果设置为 ingress ，则会允许 Swarm 中的节点之间进行负载均衡。")])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('ports:\n  - name: web\n    target: 80\n    host_ip: 127.0.0.1\n    published: "8080"\n    protocol: tcp\n    app_protocol: http\n    mode: host\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("h3",{attrs:{id:"volumes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#volumes"}},[s._v("#")]),s._v(" volumes")]),s._v(" "),e("p",[s._v("volumes 属性定义服务容器可访问的挂载主机路径或命名卷，支持多种挂载类型（volume、bind、tmpfs、npipe 等）。它可以实现数据持久化、主机与容器文件共享或多容器数据共享。")]),s._v(" "),e("p",[s._v("配置方式也分为短格式和长格式两种。")]),s._v(" "),e("h4",{attrs:{id:"短格式-常用-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#短格式-常用-2"}},[s._v("#")]),s._v(" 短格式（常用）")]),s._v(" "),e("p",[s._v("通过冒号分隔的字符串配置， "),e("code",[s._v("VOLUME:CONTAINER_PATH:ACCESS_MODE")]),s._v(" 。")]),s._v(" "),e("ul",[e("li",[s._v("VOLUME ：挂载源（可选），支持两种类型\n"),e("ul",[e("li",[s._v("主机路径：主机上的目录或文件路径，可以使用绝对路径或相对路径。相对路径如"),e("code",[s._v("./data")]),s._v("是基于 Compose 文件所在目录的")]),s._v(" "),e("li",[s._v("命名卷：需在顶级 volumes 中声明的预定义卷（如 my_volume），由 Docker 统一管理存储位置。")])])]),s._v(" "),e("li",[s._v("CONTAINER_PATH：容器路径（必填）\n"),e("ul",[e("li",[s._v("容器内需要映射的目录或文件路径，必须是绝对路径")])])]),s._v(" "),e("li",[s._v("ACCESS_MODE ：权限控制选项（可选）\n"),e("ul",[e("li",[s._v("rw ：读写模式（默认，容器可修改挂载内容）")]),s._v(" "),e("li",[s._v("ro ：只读模式（容器仅能读取，不可修改）。")]),s._v(" "),e("li",[s._v("z ：SELinux 共享标记（主机内容可被多个容器共享）。")]),s._v(" "),e("li",[s._v("Z ：SELinux 私有标记（主机内容仅当前容器可用）。")])])])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("volumes:\n  - ./code:/app/code  # 主机当前目录 code → 容器 /app/code（默认 rw）\n  - mysql_data:/var/lib/mysql  # 命名卷 mysql_data → 容器数据目录（需顶级声明）\n  - /etc/hosts:/etc/hosts:ro  # 主机 hosts 文件 → 容器 hosts（只读）\n  - ./config:/app/config:z  # SELinux 共享模式，允许其他容器访问\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("h4",{attrs:{id:"长格式-更灵活-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#长格式-更灵活-2"}},[s._v("#")]),s._v(" 长格式（更灵活）")]),s._v(" "),e("p",[s._v("通过字典形式配置更多细节，常见属性：")]),s._v(" "),e("ul",[e("li",[s._v("type（必填） ：挂载类型。支持 volume、bind、tmpfs、image、npipe、cluster")]),s._v(" "),e("li",[s._v("source（必填） ：源路径。主机路径或命名卷（与 type 对应）")]),s._v(" "),e("li",[s._v("target（必填） ：容器路径。")]),s._v(" "),e("li",[s._v("read_only ：是否只读（可选，默认 false）。")])]),s._v(" "),e("p",[s._v("以下为类型专属配置（按需添加）")]),s._v(" "),e("ul",[e("li",[s._v("bind ：仅 type: bind 时生效：\n"),e("ul",[e("li",[s._v("propagation ：传播模式。如 rprivate、shared（控制挂载权限传播）")]),s._v(" "),e("li",[s._v("create_host_path ：主机路径不存在时是否自动创建。默认为 true 。")]),s._v(" "),e("li",[s._v("selinux ：SELinux 标记， z （共享）或 Z （私有）")])])]),s._v(" "),e("li",[s._v("volume ：仅 type: volume 时生效\n"),e("ul",[e("li",[s._v("nocopy ：创建卷时是否跳过从容器复制数据（默认 false）")]),s._v(" "),e("li",[s._v("subpath ：挂载卷内的子目录（如卷 my_volume 的 /logs 子目录）")])])]),s._v(" "),e("li",[s._v("tmpfs ：仅 type: tmpfs 时生效\n"),e("ul",[e("li",[s._v("size ：临时卷大小，如 100m、512k。")]),s._v(" "),e("li",[s._v("mode ：文件权限。以八进制数表示 Unix 权限位，如 0755。")])])]),s._v(" "),e("li",[s._v("image ：仅 type: image 时生效（从其他镜像挂载数据）\n"),e("ul",[e("li",[s._v("subpath ：源镜像内的子路径")])])]),s._v(" "),e("li",[s._v("consistency ：挂载的一致性要求。可用值因平台而异（如 macOS 的 delegated、cached）。")])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("volumes:\n  - type: bind\n    source: ./data\n    target: /app/data\n    read_only: true\n    bind:\n      create_host_path: false  # 主机路径不存在时不自动创建（避免误创建）\n\n- type: volume\n  source: logs_volume\n  target: /app/logs\n  volume:\n    subpath: app_logs  # 仅挂载 logs_volume 卷内的 app_logs 子目录\n\n- type: tmpfs\n  target: /app/cache\n  tmpfs:\n    size: 50m  # 限制临时卷大小为 50MB\n    mode: 0777  # 允许所有用户读写\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("h4",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[s._v("#")]),s._v(" 注意事项")]),s._v(" "),e("ol",[e("li",[s._v("路径格式：")])]),s._v(" "),e("ul",[e("li",[s._v("主机路径在 Windows 上需用反斜杠（C:\\data:/app/data），Linux/macOS 用正斜杠（/data:/app/data）。")]),s._v(" "),e("li",[s._v("容器路径必须是绝对路径（如 /app/data，不能是 app/data）。")])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("权限问题：绑定挂载时，主机文件/目录的权限直接影响容器访问，需提前用chmod 或 chown在主机设置目录权限。")]),s._v(" "),e("li",[s._v("数据覆盖：挂载后，容器路径原有的文件/目录会被挂载源内容覆盖（卸载后恢复容器原内容）。")]),s._v(" "),e("li",[s._v("顶级 volumes 关联：")])]),s._v(" "),e("ul",[e("li",[s._v("命名卷必须在顶级 volumes 中声明。")]),s._v(" "),e("li",[s._v("绑定挂载（bind）、临时卷（tmpfs）无需在顶级声明")])]),s._v(" "),e("h3",{attrs:{id:"environment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#environment"}},[s._v("#")]),s._v(" environment")]),s._v(" "),e("p",[s._v("environment 属性定义了容器中设置的环境变量。支持两种配置格式：Array（数组）和Map（映射），可根据需求选择。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# Array（数组）格式\nenvironment:\n  - SHOW=true\n\n\n# Map（映射）格式\nenvironment:\n  SHOW: "true"\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("注意事项：")]),s._v(" "),e("ol",[e("li",[s._v("值的来源")])]),s._v(" "),e("ul",[e("li",[s._v("显式定义：直接在environment里指定的变量值，优先级最高。")]),s._v(" "),e("li",[s._v("继承主机变量：容器会继承主机中同名环境变量的值（若主机未定义，则容器内该变量为空）")]),s._v(" "),e("li",[s._v("引用其他变量：容器内的环境变量可引用已定义的变量（如 PATH=$HOME/bin:$PATH），但需注意 Compose 不会解析变量，仅原样传递给容器，由容器内的 shell 解析。")]),s._v(" "),e("li",[s._v("优先级：environment 中显式定义的变量会覆盖 env_file 或 .env 文件中同名的变量（显式定义 > env_file > .env）。")])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("特殊字符处理")])]),s._v(" "),e("ul",[e("li",[s._v('若值包含空格、引号、冒号等特殊字符，建议用Map（映射）格式并加引号（如 KEY: "Hello: World"），避免 YAML 解析错误。')]),s._v(" "),e("li",[s._v("单引号和双引号的区别：双引号内的特殊字符（如 $）会被容器内的 shell 解析，单引号则原样保留（如 KEY: '$(echo hello)' 会保留字符串 $(echo hello)，而 KEY: \"$(echo hello)\" 会被解析为 hello）。")])]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("可在 Compose 文件所在目录创建 .env 文件存储环境变量，然后在 environment 中通过 ${变量名} 引用，实现配置与代码分离。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# .env 文件内容：\nDB_PASSWORD=secret123\nAPP_ENV=production\n\n# Compose 配置\n\nservices:\n  app:\n    environment:\n      - DB_PASS=${DB_PASSWORD}  # 引用 .env 中的 DB_PASSWORD\n      - ENV=${APP_ENV:-development}  # 若 APP_ENV 未定义，默认值为 development\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("ol",{attrs:{start:"4"}},[e("li",[s._v("与 env_file 的区别")])]),s._v(" "),e("ul",[e("li",[s._v("environment 用于直接在 Compose 文件中定义环境变量，适合少量关键配置。")]),s._v(" "),e("li",[s._v("env_file 属性用于指定一个或多个包含要传递给容器的环境变量的文件，适合大量配置："),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 列表中的文件按从上到下的顺序处理\nenv_file:\n  - ./a.env\n  - ./b.env\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])])])]),s._v(" "),e("ol",{attrs:{start:"5"}},[e("li",[e("p",[s._v("敏感信息安全：environment 中的变量会明文显示在 docker compose config、docker inspect 等命令的输出中，不适合存储密码、密钥等敏感信息（建议使用 Docker Secrets 或外部密钥管理工具）。")])]),s._v(" "),e("li",[e("p",[s._v("容器内可见性：环境变量仅在容器启动时注入，若容器内的应用程序需要动态刷新配置，需通过其他方式（如配置文件挂载）实现。")])])]),s._v(" "),e("h3",{attrs:{id:"depends-on"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#depends-on"}},[s._v("#")]),s._v(" depends_on")]),s._v(" "),e("p",[s._v("depends_on 属性用于定义服务之间的依赖关系，控制服务的启动、关闭顺序及依赖条件（如等待依赖服务就绪），确保服务按预期依赖关系运行。")]),s._v(" "),e("h4",{attrs:{id:"短语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#短语法"}},[s._v("#")]),s._v(" 短语法")]),s._v(" "),e("p",[s._v("通过列表指定依赖的服务名称，仅控制启动和关闭的先后顺序，不包含额外条件。行为说明：")]),s._v(" "),e("ul",[e("li",[s._v("启动顺序：依赖的服务会先于当前服务创建（如 web 依赖 db 和 redis，则 db、redis 先启动，再启动 web）。")]),s._v(" "),e("li",[s._v("关闭顺序：当前服务会先于依赖的服务删除（如 web 先停止，再停止 db、redis）。")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("services:\n  web:\n    depends_on:\n      - db    # web 依赖 db，db 先启动\n      - redis # web 依赖 redis，redis 先启动\n  db:\n    image: mysql\n  redis:\n    image: redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("h4",{attrs:{id:"长语法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#长语法"}},[s._v("#")]),s._v(" 长语法")]),s._v(" "),e("p",[s._v("通过字典形式配置依赖的详细条件，支持更精细的依赖控制，包含以下字段：")]),s._v(" "),e("ul",[e("li",[s._v("condition（必填） ：设置依赖关系被视为满足的条件\n"),e("ul",[e("li",[s._v("service_started ：依赖服务启动即可（与短语法等效），不保证服务内部已就绪（如数据库启动但未完成初始化）")]),s._v(" "),e("li",[s._v("service_healthy ：依赖服务必须通过 healthcheck 检查（标记为 “健康”）")]),s._v(" "),e("li",[s._v("service_completed_successfully ：依赖服务必须成功运行并退出（如一次性任务）")])])]),s._v(" "),e("li",[s._v("restart（可选） ：设为 true 时，若依赖服务更新（如重启、重建），当前服务会自动重启（仅针对 Compose 显式操作，不包括容器运行时的自动重启）")]),s._v(" "),e("li",[s._v("required（可选） ：设为 false 时，若依赖服务未启动或不可用，Compose 仅警告不终止操作。默认 true，即依赖服务必须可用，否则当前服务启动失败")])]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('services:\n  web:\n    depends_on:\n      db:\n        condition: service_healthy  # 等待 db 健康检查通过才启动 web\n        restart: true               # 若 db 重启，web 也自动重启\n      redis:\n        condition: service_started  # 仅需 redis 启动即可\n        required: false             # 即使 redis 不可用，也仅警告不终止 web 启动\n  db:\n    image: mysql\n    healthcheck:  # 定义健康检查（配合 service_healthy 使用）\n      test: ["CMD", "mysqladmin", "ping", "-h", "localhost"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n  redis:\n    image: redis\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br")])]),e("h3",{attrs:{id:"command"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#command"}},[s._v("#")]),s._v(" command")]),s._v(" "),e("p",[s._v("command 覆盖容器镜像声明的默认命令，例如 Dockerfile 的 CMD。command 支持两种配置方式，根据命令的复杂度选择。")]),s._v(" "),e("h4",{attrs:{id:"字符串格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#字符串格式"}},[s._v("#")]),s._v(" 字符串格式")]),s._v(" "),e("p",[s._v("直接以字符串形式指定命令，与在终端执行命令的格式一致：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("command: python script.py  # 启动时执行 python script.py（覆盖镜像默认命令）\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"列表格式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#列表格式"}},[s._v("#")]),s._v(" 列表格式")]),s._v(" "),e("p",[s._v("适合含空格或特殊字符的命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('command: ["python", "script.py", "--debug", "true"]  # 等效于 python script.py --debug true\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#规则"}},[s._v("#")]),s._v(" 规则")]),s._v(" "),e("ol",[e("li",[s._v("与镜像默认命令的关系")])]),s._v(" "),e("ul",[e("li",[s._v('镜像的 Dockerfile 中通常会用 CMD 定义默认命令（如 CMD ["nginx", "-g", "daemon off;"]）。')]),s._v(" "),e("li",[s._v("command 会完全覆盖 CMD 的值，但不会覆盖 ENTRYPOINT（若镜像定义了 ENTRYPOINT，command 的值会作为参数传递给 ENTRYPOINT）。")]),s._v(" "),e("li",[s._v("command 的优先级高于镜像的 CMD，但低于 entrypoint。")])]),s._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[s._v("命令执行环境")])]),s._v(" "),e("ul",[e("li",[s._v("命令在容器的默认工作目录（由镜像 WORKDIR 定义）中执行，若需指定其他目录，可在命令中包含路径（如 cd /app && python script.py）。")]),s._v(" "),e("li",[s._v('命令可引用容器内的环境变量（如 command: echo "DB_HOST is $DB_HOST"，需确保变量已通过 environment 定义）。')])]),s._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[s._v("特殊场景处理")])]),s._v(" "),e("ul",[e("li",[s._v("若命令包含管道（|）、重定向（>）等 shell 特性，需显式通过 shell 执行，否则可能失效："),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 正确：通过 /bin/sh 执行带管道的命令\ncommand: /bin/sh -c "ls /app | grep .py"\n\n# 错误：直接使用管道，可能无法解析\ncommand: ls /app | grep .py\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("li",[s._v("多行命令可通过列表或 shell 分号拼接："),e("code",[s._v('command: /bin/sh -c "python setup.py; python run.py"')])])]),s._v(" "),e("h3",{attrs:{id:"user"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#user"}},[s._v("#")]),s._v(" user")]),s._v(" "),e("p",[s._v("user用于指定运行容器进程的用户 / 用户组，默认继承镜像的USER配置（Dockerfile 中定义），未定义则为root（UID=0）。")]),s._v(" "),e("p",[s._v("它有三种写法：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("# 写法1：直接写用户名 / 用户ID（新手推荐，简洁通用）\nuser: root  # 用户名（root是Linux系统默认超级用户，等价UID=0）\nuser: 0     # UID（root的UID固定为0）\n\n# 写法2：用户名:用户组 / UID:GID（精准控制权限）\nuser: 1000:1000  # UID:GID（普通用户常用ID，推荐）\nuser: admin:admin  # 用户名:用户组（⚠️ 容器内必须预先存在该用户/组，否则启动失败）\n\n# 写法3：仅指定用户组（极少用，特殊权限隔离）\nuser: :1000  # 仅指定GID，用户名沿用容器默认（通常是root）\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("h3",{attrs:{id:"privileged"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#privileged"}},[s._v("#")]),s._v(" privileged")]),s._v(" "),e("p",[s._v("默认情况下，容器受 Linux 命名空间隔离，权限受限；开启特权模式后，容器可突破隔离，授予容器几乎与主机相同的权限（如访问所有设备、修改内核参数等）。")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("privileged: true  # 开启特权模式（默认 false）\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("注意：特权模式会显著降低容器安全性，仅在必要场景（如需要直接访问主机硬件、修改内核配置）使用，生产环境需谨慎。")])]),s._v(" "),e("h3",{attrs:{id:"resources"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#resources"}},[s._v("#")]),s._v(" resources")]),s._v(" "),e("p",[s._v("resources 用于配置容器的资源约束（CPU、内存等），控制容器对主机物理资源的使用，避免单个容器过度占用资源。")]),s._v(" "),e("p",[s._v("deploy.resources 主要用于 Swarm 集群，单机模式下部分配置（如 cpus、memory）可直接生效，但推荐统一用 deploy 字段保持兼容性。其中develop 是开发环境专属配置，用于实现代码自动同步、服务热更新，减少手动重启 / 重建操作，提升开发效率。")]),s._v(" "),e("p",[s._v("核心配置项：")]),s._v(" "),e("ul",[e("li",[s._v("limits ：容器可使用的最大资源（平台强制限制，超出会被节流或终止）。")]),s._v(" "),e("li",[s._v("reservations ：容器需保证分配的最小资源（平台优先满足，未达此值可能启动失败）。")])]),s._v(" "),e("p",[s._v("常用资源类型：")]),s._v(" "),e("ul",[e("li",[s._v("cpus: CPU 核心数限制 / 预留（如 '1' 表示 1 核，'0.5' 表示半核）。")]),s._v(" "),e("li",[s._v("memory：内存限制 / 预留（支持单位 M/G，如 2G、1024M）。")]),s._v(" "),e("li",[s._v("pids：容器内允许的最大进程数（整数，如 100 限制最多 100 个进程）。")]),s._v(" "),e("li",[s._v("devices：硬件设备预留（如 GPU、TPU），需配合以下子字段：\n"),e("ul",[e("li",[s._v("capabilities（必填）：设备功能列表（如 [gpu] 表示需要 GPU）。")]),s._v(" "),e("li",[s._v("driver（可选）：设备驱动程序（如 nvidia 针对 NVIDIA GPU）。")]),s._v(" "),e("li",[s._v("count（可选）：预留设备数量（all 表示所有符合条件的设备，整数表示至少 N 个）。")]),s._v(" "),e("li",[s._v("device_ids（可选）：指定设备 ID 列表（与 count 互斥）。")])])])]),s._v(" "),e("p",[s._v("示例：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("services:\n  app:\n    image: myapp\n    deploy:  # Swarm 模式下用 deploy.resources\n      resources:\n        limits:\n          cpus: '2'        # 最多使用 2 核 CPU\n          memory: 4G       # 最多使用 4GB 内存\n          pids: 500        # 最多 500 个进程\n        reservations:\n          cpus: '1'        # 至少保证 1 核 CPU\n          memory: 2G       # 至少保证 2GB 内存\n          devices:\n            - capabilities: [gpu]  # 预留 GPU 设备\n              driver: nvidia       # 使用 NVIDIA 驱动\n              count: 1             # 至少 1 个 GPU\n\n  # 单机模式（非 Swarm）可直接在服务下配置 resources（部分版本支持）\n  worker:\n    image: worker\n    resources:\n      limits:\n        cpus: '0.5'\n        memory: 1G\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br")])]),e("h3",{attrs:{id:"logging"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#logging"}},[s._v("#")]),s._v(" logging")]),s._v(" "),e("p",[s._v("logging 用于配置容器的日志记录，默认使用 Docker 的内置日志系统，可自定义日志记录方式、存储位置等。")]),s._v(" "),e("p",[s._v("参数详解")]),s._v(" "),e("ul",[e("li",[s._v("driver：指定日志驱动类型\n"),e("ul",[e("li",[s._v("json-file（默认）：日志存为 JSON 文件")]),s._v(" "),e("li",[s._v("local：本地日志驱动")]),s._v(" "),e("li",[s._v("syslog：发送到 syslog 服务器")]),s._v(" "),e("li",[s._v("journald：发送到 systemd journal")]),s._v(" "),e("li",[s._v("none：禁用日志收集")])])]),s._v(" "),e("li",[s._v("options：驱动的自定义配置，不同驱动的 options 不同")])]),s._v(" "),e("p",[s._v("常用 logging 配置示例")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 本地日志轮转（最常用）\n# 针对默认的 json-file 或 local 驱动，配置日志大小限制和轮转，避免日志文件占满磁盘\nlogging:\n  driver: "local"\n  options:\n    max-size: "10m"    # 单个日志文件最大 10MB\n    max-file: "3"      # 最多保留 3 个日志文件\n    compress: "true"   # 轮转后的日志自动压缩（仅 local 驱动支持）\n    \n\n# 禁用容器日志\n# 适用于不需要日志的临时容器\nlogging:\n  driver: "none"  # 完全禁用日志收集\n\n# 输出到 syslog 服务器\n# 适用于集中化日志收集（需提前部署 syslog 服务器）\nlogging:\n  driver: "syslog"\n  options:\n    syslog-address: "tcp://192.168.1.100:514"  # syslog 服务器地址\n    syslog-tag: "my-api"                       # 日志标签（便于区分服务）\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])])])}),[],!1,null,null,null);e.default=t.exports},991:function(s,e,a){s.exports=a.p+"assets/img/compose-01.761aaf5b.png"},992:function(s,e,a){s.exports=a.p+"assets/img/compose-02.7646e2e8.png"},993:function(s,e,a){s.exports=a.p+"assets/img/compose-03.dfdabc91.png"}}]);